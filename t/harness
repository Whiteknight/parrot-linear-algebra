#! parrot-nqp

INIT {
    pir::load_bytecode('rosella/tap_harness.pbc');
    pir::load_bytecode('rosella/test.pbc');
    pir::load_bytecode('t/testlib/pla_test.pbc');
}

my $harness := Rosella::build(Rosella::Harness);

# First run the sanity tests. The sanity tests load the dynamic library, which
# is required for everything else. Don't attempt to run any other tests if the
# sanity test fails
$harness.add_test_dirs("NQP", 't');
$harness.run(:run_inline(1));
if ($harness.run_was_success()) {
    $harness.add_test_dirs("NQP",
        't/pmc',
        't/methods/nummatrix2d',
        't/methods/complexmatrix2d',
        't/methods/pmcmatrix2d',
    );
    $harness.add_test_dirs("PIR", 't/pir-subclass');
    $harness.run(:run_inline(1));
}
my $output := Rosella::build(Rosella::Harness::Output);
$output.show_results_summary($harness);
$output.show_error_detail($harness);
$output.show_failure_detail($harness);
